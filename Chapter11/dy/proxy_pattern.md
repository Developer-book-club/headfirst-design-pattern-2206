# βοΈ ν”„λ΅μ‹ ν¨ν„΄ Proxy Pattern

**ν”„λ΅μ‹ ν¨ν„΄** : νΉμ • κ°μ²΄λ΅μ μ ‘κ·Όμ„ μ μ–΄ν•λ” λ€λ¦¬μΈ(νΉμ • κ°μ²΄λ¥Ό λ€λ³€ν•λ” κ°μ²΄) μ κ³µ  

- ν”„λ΅μ‹ ν¨ν„΄μ„ μ‚¬μ©ν•λ©΄ μ›κ²© κ°μ²΄, μƒμ„±ν•κΈ° νλ“  κ°μ²΄, λ³΄μ•μ΄ μ¤‘μ”ν• κ°μ²΄μ™€ κ°™μ€ λ‹¤λ¥Έ κ°μ²΄λ΅μ μ ‘κ·Όμ„ μ μ–΄ν•λ” λ€λ¦¬μΈ κ°μ²΄λ¥Ό λ§λ“¤ μ μλ‹¤.
- `μ›κ²© ν”„λ΅μ‹`λ¥Ό μ¨μ„ μ›κ²© κ°μ²΄λ΅μ μ ‘κ·Όμ„ μ μ–΄ν•  μ μλ‹¤.
- `κ°€μƒ ν”„λ΅μ‹`λ¥Ό μ¨μ„ μƒμ„±ν•κΈ° νλ“  μμ›μΌλ΅μ μ ‘κ·Όμ„ μ μ–΄ν•  μ μλ‹¤.
- `λ³΄νΈ ν”„λ΅μ‹`λ¥Ό μ¨μ„ μ ‘κ·Ό κ¶ν•μ΄ ν•„μ”ν• μμ›μΌλ΅μ μ ‘κ·Όμ„ μ μ–΄ν•  μ μλ‹¤.

![proxy pattern](https://refactoring.guru/images/patterns/diagrams/proxy/structure-2x.png?id=3d54eeca9af4aa373e989a73463539b5)

## π‘½ μ›κ²© ν”„λ΅μ‹

- μ›κ²© ν”„λ΅μ‹μ μ—­ν•  : μ›κ²© κ°μ²΄μ **λ΅μ»¬ λ€λ³€μ**
  - **μ›κ²© κ°μ²΄** : λ‹¤λ¥Έ μ£Όμ† κ³µκ°„(λ‹¤λ¥Έ JVMμ Heapμ—μ„ μ‚΄κ³  μλ” κ°μ²΄)
  - **λ΅μ»¬ λ€λ³€μ** : λ΅μ»¬ λ€λ³€μμ μ–΄λ–¤ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ©΄, λ‹¤λ¥Έ μ›κ²© κ°μ²΄μ— κ·Έ λ©”μ†λ“ νΈμ¶μ„ μ „λ‹¬ν•΄ μ£Όλ” κ°μ²΄
- ν΄λΌμ΄μ–ΈνΈ κ°μ²΄λ” μ›κ²© κ°μ²΄μ λ©”μ†λ“ νΈμ¶μ„ ν•λ” κ²ƒ μ²λΌ ν–‰λ™ν•μ§€λ§, μ‹¤μ λ΅λ” **λ΅μ»¬ ν™μ— λ“¤μ–΄μλ” `ν”„λ΅μ‹`κ°μ²΄μ λ©”μ†λ“λ¥Ό νΈμ¶ν•κ³  μλ‹¤.
- λ„¤νΈμ›ν¬ ν†µμ‹ κ³Ό κ΄€λ ¨λ μ €μμ¤€ μ‘μ—…μ€ ν”„λ΅μ‹ κ°μ²΄μ—μ„ μ²λ¦¬ν•΄μ¤€λ‹¤.

### π‘½ μ›κ²© λ©”μ†λ“
![remote method](https://miro.medium.com/max/975/1*g8neQevs0ESl7swCpaNnxA.png)
- **ν΄λΌμ΄μ–ΈνΈ κ°μ²΄** : μ§„μ§ μ„λΉ„μ¤μ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ‹¤κ³  μƒκ°ν•λ‹¤.
- **ν΄λΌμ΄μ–ΈνΈ λ³΄μ΅° κ°μ²΄** = proxy. μ›κ²© κ°μ²΄λ΅ μ”μ²­μ„ μ „λ‹¬ν•λ‹¤.
- **μ„λΉ„μ¤ λ³΄μ΅° κ°μ²΄** : Socket μ—°κ²°λ΅ ν΄λΌμ΄μ–ΈνΈ λ³΄μ΅° κ°μ²΄λ΅λ¶€ν„° μ”μ²­μ„ λ°›λ”λ‹¤. λ°›μ€ μ”μ²­μ„ ν•΄μ„ν•΄μ„ μ§„μ§ μ„λΉ„μ¤μ— μλ” λ©”μ†λ“λ¥Ό νΈμ¶ν•λ‹¤.
- **μ„λΉ„μ¤ κ°μ²΄** : μ‹¤μ λ΅ μ‘μ—…μ„ μ²λ¦¬ν•λ” λ©”μ†λ“κ°€ λ“¤μ–΄μλ‹¤. 

## π›Έ μλ°” RMI `Remote Method Invocation`

### π›Έ RMIμ κΈ°λ¥
- RMIλ” ν΄λΌμ΄μ–ΈνΈμ™€ μ„λΉ„μ¤ λ³΄μ΅° κ°μ²΄λ¥Ό λ§λ“¤μ–΄μ¤€λ‹¤.
- λ³΄μ΅° κ°μ²΄μ—λ” μ›κ²© μ„λΉ„μ¤μ™€ λ‘κ°™μ€ λ©”μ†λ“κ°€ λ“¤μ–΄κ°„λ‹¤.
- λ„¤νΈμ›ν‚Ή λ° μ…μ¶λ ¥ κ΄€λ ¨ μ½”λ“λ¥Ό μ§μ ‘ μ‘μ„±ν•μ§€ μ•μ•„λ„ λλ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ” κ·Έλƒ¥ κ°™μ€ λ΅μ»¬ JVMμ— μλ” λ©”μ†λ“λ¥Ό νΈμ¶ν•λ“―μ΄ μ›κ²© λ©”μ†λ“λ¥Ό νΈμ¶ν•  μ μλ‹¤.

### π›Έ RMI κµ¬μ΅°
- **μ¤ν…**`stub`: ν΄λΌμ΄μ–ΈνΈ λ³΄μ΅° κ°μ²΄
- **μ¤μΌλ ν†¤**`skeleton`: μ„λΉ„μ¤ λ³΄μ΅° κ°μ²΄
- `lookup` : ν΄λΌμ΄μ–ΈνΈκ°€ μ›κ²© κ°μ²΄λ¥Ό μ°Ύμ•„μ„ μ ‘κ·Όν•  λ• μ“Έ μ μλ” μ„λΉ„μ¤
![RMI](https://t1.daumcdn.net/cfile/tistory/2704234F58ABB10B1D)

- `Subject`: `Proxy`μ™€ `RealSubject` λ¨λ‘ `Subject`μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄ μ–΄λ–¤ ν΄λΌμ΄μ–ΈνΈμ—μ„λ“  ν”„λ΅μ‹λ¥Ό `Subject`μ™€ λ‘κ°™μ€ μ‹μΌλ΅ λ‹¤λ£° μ μλ‹¤.
- `RealSubject`: μ§„μ§ μ‘μ—…μ„ λ€λ¶€λ¶„ μ²λ¦¬ν•λ” κ°μ²΄. 
- `Proxy`: μ§„μ§ μ‘μ—…μ„ μ²λ¦¬ν•λ” κ°μ²΄μ λ νΌλ°μ¤κ°€ λ“¤μ–΄μλ‹¤. `RealSubject`μ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•κ±°λ‚, κ·Έ κ°μ²΄μ μƒμ„± κ³Όμ •μ— κ΄€μ—¬ν•λ κ²½μ°κ°€ λ§λ‹¤. `RealSubject`λ΅μ μ ‘κ·Όμ„ μ μ–΄ν•λ‹¤.

### π‘½ μ›κ²© μ„λΉ„μ¤ λ§λ“λ” λ°©λ²•

#### 1. μ›κ²© μΈν„°νμ΄μ¤ λ§λ“¤κΈ°
ν΄λΌμ΄μ–ΈνΈκ°€ μ›κ²©μΌλ΅ νΈμ¶ν•  λ©”μ†λ“ μ •μ. μ¤ν…κ³Ό μ‹¤μ  μ„λΉ„μ¤μ— μ΄ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ•Ό ν•λ‹¤.  

1. `java.rmi.Remote`λ¥Ό ν™•μ¥ν•μ—¬ μ‚¬μ©ν•λ‹¤. (μΈν„°νμ΄μ¤λ¥Ό ν™•μ¥ν•΄μ„ λ‹¤λ¥Έ μΈν„°νμ΄μ¤λ¥Ό λ§λ“¤ μ μλ‹¤.)
  ```java
  public interface MyRemote extends Remote
  ```
2. λ¨λ“  λ©”μ†λ“κ°€ `RemoteException`μ„ λμ§€λ„λ΅ μ„ μ–Έν•λ‹¤. λ¨λ“  μ›κ²© λ©”μ†λ“ νΈμ¶μ€ μ„ν—μ΄ λ”°λ¥΄λ” κ²ƒμΌλ΅ κ°„μ£Όν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ—μ„ μμ™Έ μƒν™© λ°μƒμ„ λ€λΉ„ν•λ‹¤.
3. μ›κ²© λ©”μ†λ“μ μΈμμ™€ λ¦¬ν„΄κ°’μ€ λ°λ“μ‹ primitive λλ” Serializable ν•μ‹μΌλ΅ μ„ μ–Έν•λ‹¤.

#### 2. μ„λΉ„μ¤ κµ¬ν„ ν΄λμ¤ λ§λ“¤κΈ°
μ‹¤μ  μ‘μ—…μ„ μ²λ¦¬ν•λ” ν΄λμ¤. ν΄λΌμ΄μ–ΈνΈμ—μ„ μ΄ κ°μ²΄μ— μλ” λ©”μ†λ“λ¥Ό νΈμ¶. μ‹¤μ  μ‘μ—…μ„ μ²λ¦¬ν•λ” λ©”μ†λ“κ°€ κµ¬ν„λμ–΄ μλ‹¤.  

1. μ„λΉ„μ¤ ν΄λμ¤μ— μ›κ²© μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ‹¤.
  ```java
  public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
    // overideν• λ©”μ†λ“
  }
  ```
2. `UnicastRemoteObject`μ„ ν™•μ¥ν•λ‹¤. μ›κ²© μ„λΉ„μ¤ κ°μ²΄ μ—­ν• μ„ ν•λ ¤λ©΄ μ›κ²© κ°μ²΄ κΈ°λ¥μ„ μ¶”κ°€ν•΄μ•Ό λλ”λ°, μ΄λ” `java.rmi.server`μ `UnicastRemoteObject`λ¥Ό ν™•μ¥ν•΄μ„ μνΌν΄λμ¤μ—μ„ μ κ³µν•λ” κΈ°λ¥μΌλ΅ μ²λ¦¬ν•  μ μλ‹¤.
  ```java
  public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
    private static final long serialVersionUID = 1L;
    // overideν• λ©”μ†λ“
  }
  ```
3. `RemoteException`μ„ μ„ μ–Έν•λ” μƒμ„±μλ¥Ό κµ¬ν„ν•λ‹¤.
  ```java
  public MyRemoteImpl() throws RemoteException();
  ```
4. μ„λΉ„μ¤λ¥Ό RMI λ μ§€μ¤νΈλ¦¬μ— λ“±λ΅ν•λ‹¤. μ›κ²© μ„λΉ„μ¤λ¥Ό μ›κ²© ν΄λΌμ΄μ–ΈνΈμ—μ„ μ“Έ μ μκ² μΈμ¤ν„΄μ¤λ¥Ό λ§λ“  λ‹¤μ RMI λ μ§€μ¤νΈλ¦¬λ¥Ό λ“±λ΅ν•λ‹¤.
  ```java
  try {
    MyRemote service = new MyRemoteImpl();
    Naming.rebind("RemoteHello", service);  // μ—¬κΈ°μ„ λ“±λ΅ν• μ΄λ¦„μΌλ΅ rmiRegistryμ— κ²°ν•©
  } catch (Exception ex) {...}
  ```

##### π‘½ μ„λ²„μ—μ„ μ“°λ” μ½”λ“ μƒν”

###### μ›κ²© μΈν„°νμ΄μ¤ 

```java
import java.rmi.*;

public interface MyRemote extends Remote {
  public String sayHello() throws RemoteException;
}
```

###### μ›κ²© μ„λΉ„μ¤λ¥Ό κµ¬ν„ν• ν΄λμ¤

```java
import java.rmi.*;
import java.rmi.server.*;

public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {
  private static final long serialVersionUID = 1L;

  public String sayHello() {
    return "Server says, 'Hey'";
  }

  public MyRemoteImpl() throws RemoteException{ }

  public static void main (String[] args) {
    try {
      MyRemote service = new MyRemoteImpl();
      Naming.rebind("RemoteHello", service);
    } catch (Exception ex) {
      ex.printStackTrace();
    }
  }
}
```


#### 3. RMI registry μ‹¤ν–‰ν•κΈ°
λ‹¤λ¥Έ ν„°λ―Έλ©€ μ°½μ—μ„ `%rmiregistry`μ‹¤ν–‰ν•λ‹¤. μ΄ λ μ§€μ¤νΈλ¦¬λ΅λ¶€ν„° ν”„λ΅μ‹(μ¤ν…, ν΄λΌμ΄μ–ΈνΈ λ³΄μ΅° κ°μ²΄)λ¥Ό λ°›μ•„κ°„λ‹¤.  

#### 4. μ›κ²© μ„λΉ„μ¤ μ‹¤ν–‰ν•κΈ°
λ‹¤λ¥Έ ν„°λ―Έλ„μ„ μ—΄κ³  μ„λΉ„μ¤ κ°μ²΄λ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ‹¤. μ„λΉ„μ¤λ¥Ό κµ¬ν„ν• ν΄λμ¤μ—μ„ μ„λΉ„μ¤μ μΈμ¤ν„΄μ¤λ¥Ό λ§λ“¤κ³  κ·Έ μΈμ¤ν„΄μ¤λ¥Ό RMI λ μ§€μ¤νΈλ¦¬μ— λ“±λ΅ν•λ‹¤. μ¤ν…κ³Ό μ¤μΌλ ν†¤μ€ λ³΄μ΄μ§€ μ•λ” κ³³μ—μ„ λ™μ μΌλ΅ λ§λ“ λ‹¤.

#### π‘½ μ¤ν… κ°μ²΄λ¥Ό λ£©μ—…ν•λ” ν΄λΌμ΄μ–ΈνΈ

λ μ§€μ¤νΈλ¦¬μ—μ„ λ¦¬ν„΄λ κ°μ²΄λ” Object ν•μ‹μ΄λ‹κΉ λ°λ“μ‹ μΊμ¤ν…μ„ ν•΄μ•Όν•λ‹¤.

1. ν΄λΌμ΄μ–ΈνΈμ—μ„ RMI λ μ§€μ¤νΈλ¦¬ λ£©μ—…
  ```java
  MyRemote service = (MyRemote) Naming.lookup("rmi://127.0.0.1/RemoteHello");
  ```
2. RMI λ μ§€μ¤νΈλ¦¬μ—μ„ μ¤ν… κ°μ²΄λ¥Ό λ¦¬ν„΄. μ¤ν… κ°μ²΄λ” μλ™μΌλ΅ μ—­μ§λ ¬ν™”λμ–΄μ„ μ „λ‹¬λ¨. μ΄λ• μ¤ν… ν΄λμ¤λ” λ°λ“μ‹ ν΄λΌμ΄μ–ΈνΈμ—λ§ μμ–΄μ•Ό ν•λ‹¤.
3. ν΄λΌμ΄μ–ΈνΈλ” μ¤ν…μ μ„λΉ„μ¤ λ©”μ†λ“λ¥Ό νΈμ¶ν•λ‹¤. μ¤ν…μ΄ μ§„μ§ μ„λΉ„μ¤ κ°μ²΄λΌκ³  μƒκ°ν•λ‹¤.

###### ν΄λΌμ΄μ–ΈνΈ μƒν”

```java
import java.rmi.*;

public class MyRemoteClient {
  
  public static void main (Sring[] args) {
    new MyRemoteClient().go();
  }

  public void go() {

    try {
      MyRemote service = (MyRemote) Naming.lookup("rmi://127.0.0.1/RemoteHello");
      String s = servcie.sayHello();
      System.out.println(s);
    } catch (Exception ex) {
      ex.printStackTrace();
    }
  }
}
```

## π›° κ°€μƒ ν”„λ΅μ‹

- μƒμ„±ν•λ” λ° λ§μ€ λΉ„μ©μ΄ λ“λ” κ°μ²΄λ¥Ό λ€μ‹ ν•λ‹¤.
- μ§„μ§ κ°μ²΄κ°€ ν•„μ”ν• μƒν™©μ΄ μ¤κΈ° μ „κΉμ§€ κ°μ²΄μ μƒμ„±μ„ λ―Έλ£¨λ” κΈ°λ¥μ„ μ κ³µν•λ‹¤.
- κ°μ²΄ μƒμ„±μ΄ λλ‚λ©΄ `RealSubject`μ— μ§μ ‘ μ”μ²­μ„ μ „λ‹¬ν•λ‹¤.

## π λ³΄νΈ ν”„λ΅μ‹

- **λ™μ  ν”„λ΅μ‹** : `java.lang.reflect`μ ν”„λ΅μ‹ κΈ°λ¥μ„ μ΄μ©ν•μ—¬ μ¦‰μ„μ—μ„ ν•λ‚ μ΄μƒμ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•κ³ , μ§€μ •ν• ν΄λμ¤μ— λ©”μ†λ“ νΈμ¶μ„ μ „λ‹¬ν•λ” ν”„λ΅μ‹ ν΄λμ¤κ°€ μ‹¤ν–‰ μ¤‘μ— μƒμ„±λλ” κ²ƒ
- **λ³΄νΈ ν”„λ΅μ‹** : μ ‘κ·Ό κ¶ν•μ„ λ°”νƒ•μΌλ΅ κ°μ²΄λ΅μ μ ‘κ·Όμ„ μ μ–΄ν•λ” ν”„λ΅μ‹
  - `InvocationHandler`μ— ν”„λ΅μ‹ ν΄λμ¤μ— λ„£μ„ μ μ—†λ” *Proxy ν΄λμ¤μ—κ² λ¬΄μ¨ μΌμ„ ν•΄μ•Ό ν•λ”μ§€ μ•λ ¤ μ¤„ λ°©λ²•*μ„ λ„£λ”λ‹¤.
  - `InvocationHandler`λ” ν”„λ΅μ‹μ— νΈμ¶λλ” λ¨λ“  λ©”μ†λ“μ— μ‘λ‹µν•λ‹¤. 
  - Proxyμ—μ„ λ©”μ†λ“ νΈμ¶μ„ λ°›λ”λ‹¤ β†’ `InvocationHandler`μ— μ§„μ§ μ‘μ—…μ„ λ¶€νƒν•λ‹¤.
![λ³΄νΈν”„λ΅μ‹](https://t1.daumcdn.net/cfile/tistory/266EE435543B43B112)

### λ™μ  ν”„λ΅μ‹ λ§λ“λ” λ°©λ²•

#### 1. InvocationHandler λ§λ“¤κΈ°
InvocationHandlerλ” ν”„λ΅μ‹μ ν–‰λ™μ„ κµ¬ν„ν•λ‹¤.

#### 2. λ™μ  ν”„λ΅μ‹ μƒμ„± μ½”λ“ λ§λ“¤κΈ°
ν”„λ΅μ‹ ν΄λμ¤λ¥Ό μƒμ„±ν•κ³  κ·Έ μΈμ¤ν„΄μ¤λ¥Ό λ§λ“λ” μ½”λ“λ¥Ό μ“΄λ‹¤.

#### 3. μ μ ν• ν”„λ΅μ‹λ΅ κ°μ²΄ κ°μ‹ΈκΈ°